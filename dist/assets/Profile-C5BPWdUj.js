import{r as e,d as s}from"./react-vendor-CPf6_-Gw.js";import{c as r,h as i,j as a,B as o,C as t,a as n,b as m,d as l,e as u,L as c,I as d,r as p}from"./index-DEVhnxtE.js";import{T as v,a as N,b as f,c as h}from"./tabs-LDl4Z0mk.js";import{N as D,O as b,Q as x,U as g,W as P,k as C}from"./vendor-CUHCMU-w.js";import{u as E}from"./router-vendor-BClyUQd8.js";import{m as U,U as j,z,V as w,W as O,h as V}from"./icons-vendor-C2HYFDpS.js";const y=e.forwardRef(({className:e,...i},a)=>s.jsxDEV(D,{className:r("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...i,ref:a,children:s.jsxDEV(b,{className:r("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/components/ui/switch.tsx",lineNumber:18,columnNumber:5},void 0)},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/components/ui/switch.tsx",lineNumber:10,columnNumber:3},void 0));y.displayName=D.displayName;const A=e.forwardRef(({className:e,...i},a)=>s.jsxDEV(x,{ref:a,className:r("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...i},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/components/ui/avatar.tsx",lineNumber:10,columnNumber:3},void 0));A.displayName=x.displayName;const k=e.forwardRef(({className:e,...i},a)=>s.jsxDEV(g,{ref:a,className:r("aspect-square h-full w-full",e),...i},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/components/ui/avatar.tsx",lineNumber:25,columnNumber:3},void 0));k.displayName=g.displayName;const S=e.forwardRef(({className:e,...i},a)=>s.jsxDEV(P,{ref:a,className:r("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...i},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/components/ui/avatar.tsx",lineNumber:37,columnNumber:3},void 0));S.displayName=P.displayName;const F=e=>{try{const s=sessionStorage.getItem("csrf_token");if(!s||!e)return!1;if(64!==e.length||!/^[0-9a-f]{64}$/i.test(e))return!1;if(e.length!==s.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e.charCodeAt(i)^s.charCodeAt(i);return 0===r}catch(s){return!1}},L=e=>{if(!e||"string"!=typeof e)return"";if(e.startsWith("data:image/"))return/^data:image\/(jpeg|jpg|png|gif|webp|svg\+xml);base64,([A-Za-z0-9+/=]+)$/.test(e)?C.sanitize(e,{ALLOWED_URI_REGEXP:/^data:image\/(jpeg|jpg|png|gif|webp|svg\+xml);base64,/,ALLOWED_TAGS:[],ALLOWED_ATTR:[]}):"";if(e.match(/^https?:\/\//))try{const s=new URL(e);return"http:"!==s.protocol&&"https:"!==s.protocol?"":e}catch(s){return""}return e.startsWith("blob:")?e:""},R={"image/jpeg":[255,216,255],"image/png":[137,80,78,71,13,10,26,10],"image/webp":[82,73,70,70]},I=[".jpg",".jpeg",".png",".webp"],T=["image/jpeg","image/png","image/webp"];function q(){return s.jsxDEV("div",{className:"skip-links",children:[s.jsxDEV("a",{href:"#main-content",className:"skip-link",children:"Pular para conteúdo principal"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/components/SkipLinks.tsx",lineNumber:10,columnNumber:7},this),s.jsxDEV("a",{href:"#navigation",className:"skip-link",children:"Pular para navegação"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/components/SkipLinks.tsx",lineNumber:13,columnNumber:7},this),s.jsxDEV("a",{href:"#search",className:"skip-link",children:"Pular para busca"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/components/SkipLinks.tsx",lineNumber:16,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/components/SkipLinks.tsx",lineNumber:9,columnNumber:5},this)}function Y(){var r;const{toast:D}=i(),b=E(),[x,g]=e.useState({name:"",email:"",university:"",graduationYear:(new Date).getFullYear(),avatar:""}),[P,C]=e.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[Y,M]=e.useState({theme:"system",notifications:!0,emailNotifications:!1}),[B,W]=e.useState(!1),[$,G]=e.useState(!1),[_,J]=e.useState(!1),[Z,Q]=e.useState(!1),[X,H]=e.useState(""),[K]=e.useState(()=>(()=>{const e=sessionStorage.getItem("csrf_token");return e&&64===e.length?e:(()=>{const e=(()=>{try{const e=new Uint8Array(32);return window.crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}catch(e){throw new Error("Falha ao gerar token de segurança")}})();return sessionStorage.setItem("csrf_token",e),e})()})());e.useEffect(()=>{ee()},[]),e.useEffect(()=>()=>{X&&X.startsWith("blob:")&&URL.revokeObjectURL(X)},[X]);const ee=async()=>{try{const e=a.getCurrentUser();if(e){g({name:e.name,email:e.email,university:e.university||"",graduationYear:e.graduationYear||(new Date).getFullYear(),avatar:e.avatar||""});const s=await a.getAvatarFromIndexedDB(e.id);if(s)H(s),g(e=>({...e,avatar:s}));else if(e.avatar&&e.avatar.startsWith("data:image/"))if(await a.migrateAvatarToIndexedDB(e.id,e.avatar)){const s=await a.getAvatarFromIndexedDB(e.id);s&&(H(s),g(e=>({...e,avatar:s})))}else H(e.avatar)}M({theme:"system",notifications:!0,emailNotifications:!1})}catch(e){D({title:"Erro ao carregar perfil",description:"Não foi possível carregar os dados do perfil. Tente recarregar a página.",variant:"destructive"})}};return s.jsxDEV(s.Fragment,{children:[s.jsxDEV(q,{},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:582,columnNumber:7},this),s.jsxDEV("main",{role:"main",id:"main-content",className:"container max-w-4xl mx-auto px-4 py-8 md:py-12",children:[s.jsxDEV("div",{className:"mb-8",children:[s.jsxDEV(o,{variant:"ghost",size:"sm",onClick:()=>b("/dashboard"),className:"mb-4 flex items-center gap-2","aria-label":"Voltar para a página do dashboard",children:[s.jsxDEV(U,{className:"h-4 w-4","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:592,columnNumber:13},this),"Voltar ao Dashboard"]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:585,columnNumber:11},this),s.jsxDEV("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Meu Perfil"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:596,columnNumber:11},this),s.jsxDEV("p",{className:"text-muted-foreground",children:"Gerencie suas informações pessoais e preferências"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:597,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:584,columnNumber:9},this),s.jsxDEV(v,{defaultValue:"personal",className:"space-y-6",children:[s.jsxDEV(N,{className:"grid w-full grid-cols-2 md:grid-cols-4 gap-2",role:"tablist","aria-label":"Seções do perfil",children:[s.jsxDEV(f,{value:"personal",className:"flex items-center gap-2","aria-label":"Aba Informações Pessoais",children:[s.jsxDEV(j,{className:"h-4 w-4","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:603,columnNumber:13},this),s.jsxDEV("span",{className:"hidden sm:inline",children:"Pessoal"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:604,columnNumber:13},this),s.jsxDEV("span",{className:"sm:hidden",children:"Info"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:605,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:602,columnNumber:11},this),s.jsxDEV(f,{value:"avatar",className:"flex items-center gap-2","aria-label":"Aba Avatar e Foto",children:[s.jsxDEV(z,{className:"h-4 w-4","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:608,columnNumber:13},this),s.jsxDEV("span",{className:"hidden sm:inline",children:"Avatar"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:609,columnNumber:13},this),s.jsxDEV("span",{className:"sm:hidden",children:"Foto"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:610,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:607,columnNumber:11},this),s.jsxDEV(f,{value:"security",className:"flex items-center gap-2","aria-label":"Aba Segurança e Senha",children:[s.jsxDEV(w,{className:"h-4 w-4","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:613,columnNumber:13},this),s.jsxDEV("span",{className:"hidden sm:inline",children:"Segurança"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:614,columnNumber:13},this),s.jsxDEV("span",{className:"sm:hidden",children:"Senha"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:615,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:612,columnNumber:11},this),s.jsxDEV(f,{value:"preferences",className:"flex items-center gap-2","aria-label":"Aba Preferências e Configurações",children:[s.jsxDEV(O,{className:"h-4 w-4","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:618,columnNumber:13},this),s.jsxDEV("span",{className:"hidden sm:inline",children:"Preferências"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:619,columnNumber:13},this),s.jsxDEV("span",{className:"sm:hidden",children:"Config"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:620,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:617,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:601,columnNumber:9},this),s.jsxDEV(h,{value:"personal",role:"tabpanel","aria-labelledby":"personal-tab",children:s.jsxDEV(t,{children:[s.jsxDEV(n,{children:[s.jsxDEV(m,{id:"personal-tab",children:"Informações Pessoais"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:628,columnNumber:15},this),s.jsxDEV(l,{children:"Atualize suas informações de perfil"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:629,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:627,columnNumber:13},this),s.jsxDEV(u,{className:"space-y-4",role:"form","aria-labelledby":"personal-tab",children:[s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(c,{htmlFor:"name",children:"Nome Completo"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:635,columnNumber:17},this),s.jsxDEV(d,{id:"name",value:x.name,onChange:e=>g(s=>({...s,name:e.target.value})),placeholder:"Seu nome completo",className:"min-h-[44px]"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:636,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:634,columnNumber:15},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(c,{htmlFor:"email",children:"Email"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:646,columnNumber:17},this),s.jsxDEV(d,{id:"email",type:"email",value:x.email,disabled:!0,className:"bg-muted min-h-[44px]","aria-describedby":"email-hint"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:647,columnNumber:17},this),s.jsxDEV("p",{id:"email-hint",className:"text-sm text-muted-foreground",children:"O email não pode ser alterado"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:655,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:645,columnNumber:15},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(c,{htmlFor:"university",children:"Universidade"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:661,columnNumber:17},this),s.jsxDEV(d,{id:"university",value:x.university,onChange:e=>g(s=>({...s,university:e.target.value})),placeholder:"Nome da sua universidade",className:"min-h-[44px]"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:662,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:660,columnNumber:15},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(c,{htmlFor:"graduationYear",children:"Ano de Formatura"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:672,columnNumber:17},this),s.jsxDEV(d,{id:"graduationYear",type:"number",min:(new Date).getFullYear(),max:(new Date).getFullYear()+10,value:x.graduationYear,onChange:e=>{const s=parseInt(e.target.value),r=(new Date).getFullYear();s<r?D({title:"Ano inválido",description:`O ano de formatura não pode ser anterior a ${r}`,variant:"destructive"}):s>r+10?D({title:"Ano inválido",description:`O ano de formatura não pode ser superior a ${r+10}`,variant:"destructive"}):g(e=>({...e,graduationYear:s}))},className:"min-h-[44px]"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:673,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:671,columnNumber:15},this),s.jsxDEV(o,{onClick:async()=>{const e=a.getCurrentUser();if(e){const s=p.checkLimit("profileUpdate",e.id);if(!s.allowed)return void D({title:"Muitas tentativas",description:p.formatErrorMessage("profileUpdate",s.resetIn),variant:"destructive"})}if(F(K)){if(!(x.name.trim().length<3&&(D({title:"Nome inválido",description:"O nome deve ter pelo menos 3 caracteres",variant:"destructive"}),1))&&!(x.university.trim().length<3&&(D({title:"Universidade inválida",description:"O nome da universidade deve ter pelo menos 3 caracteres",variant:"destructive"}),1))&&(e=>{const s=(new Date).getFullYear();return!(e<s||e>s+10)||(D({title:"Ano inválido",description:"O ano de formatura deve estar entre o ano atual e daqui a 10 anos",variant:"destructive"}),!1)})(x.graduationYear)){W(!0);try{const e=a.getCurrentUser();e&&(await a.updateUser(e.id,{name:x.name,university:x.university,graduationYear:x.graduationYear}),p.recordAttempt("profileUpdate",e.id)),D({title:"Sucesso!",description:"Perfil atualizado com sucesso"})}catch(s){D({title:"Erro ao salvar",description:"Não foi possível atualizar o perfil. Tente novamente.",variant:"destructive"})}finally{W(!1)}}}else D({title:"Erro de segurança",description:"Token de sessão inválido. Recarregue a página.",variant:"destructive"})},className:"w-full md:w-auto",disabled:B,"aria-live":"polite","aria-atomic":"true",children:B?s.jsxDEV(s.Fragment,{children:[s.jsxDEV(V,{className:"mr-2 h-4 w-4 animate-spin","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:693,columnNumber:21},this),"Salvando..."]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:692,columnNumber:19},this):"Salvar Alterações"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:684,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:633,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:626,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:625,columnNumber:9},this),s.jsxDEV(h,{value:"avatar",children:s.jsxDEV(t,{children:[s.jsxDEV(n,{children:[s.jsxDEV(m,{children:"Avatar do Perfil"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:708,columnNumber:15},this),s.jsxDEV(l,{children:"Faça upload de uma foto de perfil"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:709,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:707,columnNumber:13},this),s.jsxDEV(u,{className:"space-y-6",children:s.jsxDEV("div",{className:"flex flex-col items-center gap-6",children:[s.jsxDEV("div",{className:"relative",children:[s.jsxDEV(A,{className:"h-32 w-32 md:h-40 md:w-40",children:[s.jsxDEV(k,{src:L(X||x.avatar||""),alt:`Avatar de ${x.name}`,onError:e=>{e.currentTarget.src="/default-avatar.png"}},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:717,columnNumber:21},this),s.jsxDEV(S,{className:"text-4xl",children:(null==(r=x.name)?void 0:r.split(" ").map(e=>e[0]).join("").toUpperCase())||"U"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:725,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:716,columnNumber:19},this),Z&&s.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full","aria-live":"polite","aria-atomic":"true",children:[s.jsxDEV(V,{className:"h-8 w-8 animate-spin text-white","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:735,columnNumber:23},this),s.jsxDEV("span",{className:"sr-only",children:"Enviando avatar..."},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:736,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:730,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:715,columnNumber:17},this),s.jsxDEV("div",{className:"text-center space-y-2",children:[s.jsxDEV(c,{htmlFor:"avatar-upload",className:"cursor-pointer",children:s.jsxDEV(o,{type:"button",disabled:Z,className:"flex items-center gap-2",asChild:!0,"aria-label":"Selecionar arquivo de imagem para avatar",children:s.jsxDEV("span",{children:[s.jsxDEV(z,{className:"h-4 w-4","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:751,columnNumber:25},this),Z?"Enviando...":"Escolher Imagem"]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:750,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:743,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:742,columnNumber:19},this),s.jsxDEV(d,{id:"avatar-upload",type:"file",accept:"image/*",className:"hidden",onChange:async e=>{var s;const r=null==(s=e.target.files)?void 0:s[0];if(!r)return;const i=a.getCurrentUser();if(i){const s=p.checkLimit("avatarUpload",i.id);if(!s.allowed)return D({title:"Muitas tentativas",description:p.formatErrorMessage("avatarUpload",s.resetIn),variant:"destructive"}),void(e.target.value="")}if(!F(K))return void D({title:"Erro de segurança",description:"Token de sessão inválido. Recarregue a página.",variant:"destructive"});const o=await(async e=>{const s=await(async e=>{var s;try{if(e.size>5242880)return{valid:!1,error:`Arquivo muito grande. Tamanho máximo: ${5..toFixed(1)}MB`,details:{size:e.size,type:e.type}};if(0===e.size)return{valid:!1,error:"Arquivo vazio",details:{size:0,type:e.type}};const r="."+(null==(s=e.name.split(".").pop())?void 0:s.toLowerCase())||"";if(!I.includes(r))return{valid:!1,error:`Extensão não permitida. Permitidas: ${I.join(", ")}`,details:{extension:r,size:e.size,type:e.type}};if(!T.includes(e.type))return{valid:!1,error:"Tipo de arquivo não permitido. Permitidos: imagens JPEG, PNG, WebP",details:{type:e.type,extension:r,size:e.size}};const i=await(async e=>new Promise((s,r)=>{const i=new FileReader;i.onload=e=>{var i;if(null==(i=e.target)?void 0:i.result){const r=new Uint8Array(e.target.result);s(r)}else r(new Error("Falha ao ler arquivo"))},i.onerror=()=>{r(new Error("Erro ao ler arquivo"))};const a=e.slice(0,10);i.readAsArrayBuffer(a)}))(e);return((e,s)=>{const r=R[s];if(!r)return!1;for(let i=0;i<r.length;i++)if(e[i]!==r[i])return!1;return!0})(i,e.type)?{valid:!0,details:{type:e.type,extension:r,size:e.size}}:{valid:!1,error:"Arquivo corrompido ou tipo incorreto. A assinatura do arquivo não corresponde ao tipo declarado.",details:{type:e.type,extension:r,size:e.size}}}catch(r){return{valid:!1,error:"Erro ao processar arquivo. Tente novamente."}}})(e);return s.valid?new Promise(s=>{const r=new Image,i=URL.createObjectURL(e);r.onload=()=>(URL.revokeObjectURL(i),r.width<100||r.height<100?(D({title:"Imagem muito pequena",description:"A imagem deve ter pelo menos 100x100 pixels",variant:"destructive"}),void s(!1)):r.width>2e3||r.height>2e3?(D({title:"Imagem muito grande",description:"A imagem deve ter no máximo 2000x2000 pixels",variant:"destructive"}),void s(!1)):void s(!0)),r.onerror=()=>{URL.revokeObjectURL(i),D({title:"Erro ao processar imagem",description:"Não foi possível ler o arquivo de imagem",variant:"destructive"}),s(!1)},r.src=i}):(D({title:"Arquivo inválido",description:s.error||"O arquivo não passou na validação de segurança",variant:"destructive"}),!1)})(r);if(o){Q(!0);try{const e=a.getCurrentUser();if(!e)throw new Error("Usuário não autenticado");const s=new Blob([r],{type:r.type});await a.saveAvatarToIndexedDB(e.id,s,r.type);const i=await a.getAvatarFromIndexedDB(e.id);if(!i)throw new Error("Falha ao recuperar avatar");H(i),g(e=>({...e,avatar:i})),p.recordAttempt("avatarUpload",e.id),D({title:"Sucesso!",description:"Avatar atualizado com sucesso"})}catch(t){D({title:"Erro ao salvar avatar",description:t.message||"Não foi possível salvar o avatar. Tente novamente.",variant:"destructive"})}finally{Q(!1)}}},disabled:Z,"aria-label":"Selecionar arquivo de imagem para avatar","aria-describedby":"avatar-hint"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:756,columnNumber:19},this),s.jsxDEV("p",{id:"avatar-hint",className:"text-sm text-muted-foreground",children:"PNG, JPG ou WEBP. 100-2000px. Máximo 2MB."},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:766,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:741,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:714,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:713,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:706,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:705,columnNumber:9},this),s.jsxDEV(h,{value:"security",children:s.jsxDEV(t,{children:[s.jsxDEV(n,{children:[s.jsxDEV(m,{id:"security-tab",children:"Alterar Senha"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:779,columnNumber:15},this),s.jsxDEV(l,{children:"Mantenha sua conta segura com uma senha forte"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:780,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:778,columnNumber:13},this),s.jsxDEV(u,{className:"space-y-4",role:"form","aria-labelledby":"security-tab",children:[s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(c,{htmlFor:"currentPassword",children:"Senha Atual"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:786,columnNumber:17},this),s.jsxDEV(d,{id:"currentPassword",type:"password",value:P.currentPassword,onChange:e=>C(s=>({...s,currentPassword:e.target.value})),placeholder:"Digite sua senha atual",className:"min-h-[44px]"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:787,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:785,columnNumber:15},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(c,{htmlFor:"newPassword",children:"Nova Senha"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:798,columnNumber:17},this),s.jsxDEV(d,{id:"newPassword",type:"password",value:P.newPassword,onChange:e=>C(s=>({...s,newPassword:e.target.value})),placeholder:"Digite a nova senha",className:"min-h-[44px]","aria-describedby":"newPassword-hint"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:799,columnNumber:17},this),s.jsxDEV("p",{id:"newPassword-hint",className:"text-sm text-muted-foreground",children:"Mínimo 8 caracteres, com letras maiúsculas, minúsculas, números e caracteres especiais (!@#$%)"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:808,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:797,columnNumber:15},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(c,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:814,columnNumber:17},this),s.jsxDEV(d,{id:"confirmPassword",type:"password",value:P.confirmPassword,onChange:e=>C(s=>({...s,confirmPassword:e.target.value})),placeholder:"Confirme a nova senha",className:"min-h-[44px]","aria-describedby":"confirmPassword-hint"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:815,columnNumber:17},this),s.jsxDEV("p",{id:"confirmPassword-hint",className:"sr-only",children:"Digite a mesma senha informada no campo anterior para confirmação"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:824,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:813,columnNumber:15},this),s.jsxDEV(o,{onClick:async()=>{const e=a.getCurrentUser();if(e){const s=p.checkLimit("passwordChange",e.id);if(!s.allowed)return void D({title:"Muitas tentativas",description:p.formatErrorMessage("passwordChange",s.resetIn),variant:"destructive"})}if(!F(K))return void D({title:"Erro de segurança",description:"Token de sessão inválido. Recarregue a página.",variant:"destructive"});const s=await(async()=>{if(P.currentPassword.length<8)return D({title:"Senha atual inválida",description:"A senha atual deve ter pelo menos 8 caracteres",variant:"destructive"}),!1;const e=a.getCurrentUser();if(!e)return D({title:"Erro de autenticação",description:"Usuário não encontrado. Faça login novamente.",variant:"destructive"}),!1;if(!(await a.validateCurrentPassword(e.email,P.currentPassword)))return D({title:"Senha incorreta",description:"A senha atual informada está incorreta",variant:"destructive"}),!1;if(P.newPassword.length<8)return D({title:"Nova senha inválida",description:"A nova senha deve ter pelo menos 8 caracteres",variant:"destructive"}),!1;const s=/[A-Z]/.test(P.newPassword),r=/[a-z]/.test(P.newPassword),i=/[0-9]/.test(P.newPassword),o=/[!@#$%^&*(),.?":{}|<>]/.test(P.newPassword);return s&&r&&i&&o?P.newPassword===P.confirmPassword||(D({title:"Senhas não coincidem",description:"A nova senha e a confirmação devem ser iguais",variant:"destructive"}),!1):(D({title:"Senha fraca",description:"A senha deve conter letras maiúsculas, minúsculas, números e caracteres especiais (!@#$%)",variant:"destructive"}),!1)})();if(s){G(!0);try{const e=a.getCurrentUser();if(!e)throw new Error("Usuário não autenticado");await a.updatePassword(e.id,P.currentPassword,P.newPassword),p.recordAttempt("passwordChange",e.id),D({title:"Sucesso!",description:"Senha alterada com sucesso"}),C({currentPassword:"",newPassword:"",confirmPassword:""})}catch(r){D({title:"Erro ao alterar senha",description:r.message||"Não foi possível alterar a senha. Tente novamente.",variant:"destructive"})}finally{G(!1)}}},className:"w-full md:w-auto",disabled:$,"aria-live":"polite","aria-atomic":"true",children:$?s.jsxDEV(s.Fragment,{children:[s.jsxDEV(V,{className:"mr-2 h-4 w-4 animate-spin","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:838,columnNumber:21},this),"Alterando..."]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:837,columnNumber:19},this):"Alterar Senha"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:829,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:784,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:777,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:776,columnNumber:9},this),s.jsxDEV(h,{value:"preferences",children:s.jsxDEV(t,{children:[s.jsxDEV(n,{children:[s.jsxDEV(m,{id:"preferences-tab",children:"Preferências"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:853,columnNumber:15},this),s.jsxDEV(l,{children:"Personalize sua experiência"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:854,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:852,columnNumber:13},this),s.jsxDEV(u,{className:"space-y-6",role:"form","aria-labelledby":"preferences-tab",children:[s.jsxDEV("div",{className:"space-y-4",children:[s.jsxDEV("div",{className:"flex items-center justify-between",children:[s.jsxDEV("div",{className:"space-y-0.5",children:[s.jsxDEV(c,{htmlFor:"theme-select",children:"Tema"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:862,columnNumber:21},this),s.jsxDEV("p",{id:"theme-hint",className:"text-sm text-muted-foreground",children:"Escolha o tema da interface"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:863,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:861,columnNumber:19},this),s.jsxDEV("select",{id:"theme-select","aria-label":"Selecione o tema da interface","aria-describedby":"theme-hint",value:Y.theme,onChange:e=>M(s=>({...s,theme:e.target.value})),className:"px-3 py-2 border rounded-md min-h-[44px]",children:[s.jsxDEV("option",{value:"light",children:"Claro"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:875,columnNumber:21},this),s.jsxDEV("option",{value:"dark",children:"Escuro"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:876,columnNumber:21},this),s.jsxDEV("option",{value:"system",children:"Sistema"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:877,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:867,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:860,columnNumber:17},this),s.jsxDEV("div",{className:"flex items-center justify-between",children:[s.jsxDEV("div",{className:"space-y-0.5",children:[s.jsxDEV(c,{htmlFor:"notifications-switch",children:"Notificações"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:883,columnNumber:21},this),s.jsxDEV("p",{id:"notifications-hint",className:"text-sm text-muted-foreground",children:"Receba notificações no navegador"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:884,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:882,columnNumber:19},this),s.jsxDEV(y,{id:"notifications-switch","aria-label":"Ativar notificações no navegador","aria-describedby":"notifications-hint",checked:Y.notifications,onCheckedChange:e=>M(s=>({...s,notifications:e}))},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:888,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:881,columnNumber:17},this),s.jsxDEV("div",{className:"flex items-center justify-between",children:[s.jsxDEV("div",{className:"space-y-0.5",children:[s.jsxDEV(c,{htmlFor:"email-notifications-switch",children:"Notificações por Email"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:899,columnNumber:21},this),s.jsxDEV("p",{id:"email-notifications-hint",className:"text-sm text-muted-foreground",children:"Receba atualizações por email"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:900,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:898,columnNumber:19},this),s.jsxDEV(y,{id:"email-notifications-switch","aria-label":"Ativar notificações por email","aria-describedby":"email-notifications-hint",checked:Y.emailNotifications,onCheckedChange:e=>M(s=>({...s,emailNotifications:e}))},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:904,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:897,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:859,columnNumber:15},this),s.jsxDEV(o,{onClick:async()=>{if(F(K)){J(!0);try{D({title:"Sucesso!",description:"Preferências atualizadas com sucesso"})}catch(e){D({title:"Erro ao salvar preferências",description:"Não foi possível atualizar as preferências. Tente novamente.",variant:"destructive"})}finally{J(!1)}}else D({title:"Erro de segurança",description:"Token de sessão inválido. Recarregue a página.",variant:"destructive"})},className:"w-full md:w-auto",disabled:_,"aria-live":"polite","aria-atomic":"true",children:_?s.jsxDEV(s.Fragment,{children:[s.jsxDEV(V,{className:"mr-2 h-4 w-4 animate-spin","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:923,columnNumber:21},this),"Salvando..."]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:922,columnNumber:19},this):"Salvar Preferências"},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:914,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:858,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:851,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:850,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:600,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:583,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/souza/OneDrive/Documentos/medprompts/src/pages/Profile.tsx",lineNumber:581,columnNumber:5},this)}export{Y as default};
