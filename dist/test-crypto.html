<!DOCTYPE html>
<html>
<head>
    <title>Test Web Crypto API</title>
</head>
<body>
    <h1>Test Web Crypto API</h1>
    <div id="result"></div>
    <script>
        async function testCrypto() {
            const result = document.getElementById('result');
            try {
                // Test PBKDF2
                const encoder = new TextEncoder();
                const password = encoder.encode('test123');
                const salt = window.crypto.getRandomValues(new Uint8Array(16));
                
                const keyMaterial = await window.crypto.subtle.importKey(
                    'raw',
                    password,
                    'PBKDF2',
                    false,
                    ['deriveBits']
                );
                
                const hash = await window.crypto.subtle.deriveBits(
                    {
                        name: 'PBKDF2',
                        salt: salt,
                        iterations: 100000,
                        hash: 'SHA-256'
                    },
                    keyMaterial,
                    256
                );
                
                result.innerHTML += '<p>✅ PBKDF2 funcionando!</p>';
                
                // Test HMAC
                const secret = encoder.encode('secret-key');
                const data = encoder.encode('data-to-sign');
                
                const hmacKey = await window.crypto.subtle.importKey(
                    'raw',
                    secret,
                    { name: 'HMAC', hash: 'SHA-256' },
                    false,
                    ['sign']
                );
                
                const signature = await window.crypto.subtle.sign(
                    'HMAC',
                    hmacKey,
                    data
                );
                
                result.innerHTML += '<p>✅ HMAC-SHA256 funcionando!</p>';
                result.innerHTML += '<p>✅ Web Crypto API totalmente funcional!</p>';
                result.innerHTML += '<p><a href="/medprompts/">Voltar para o site</a></p>';
                
            } catch (error) {
                result.innerHTML = '<p>❌ Erro: ' + error.message + '</p>';
                console.error(error);
            }
        }
        
        testCrypto();
    </script>
</body>
</html>
